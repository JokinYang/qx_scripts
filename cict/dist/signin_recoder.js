/*     * This is a generated file. Do not edit it manually.
        Generated by esbuild.
*/
var F=(p,f)=>()=>(f||p((f={exports:{}}).exports,f),f.exports);var C=F((T,m)=>{function _(p,f){class P{constructor(t){this.env=t}send(t,n="GET"){t=typeof t=="string"?{url:t}:t;let i=this.get;n==="POST"&&(i=this.post);let o=(h,a=1e3)=>Promise.race([h,new Promise((r,u)=>{setTimeout(()=>{u(new Error("\u8BF7\u6C42\u8D85\u65F6"))},a)})]),s=new Promise((h,a)=>{i.call(this,t,(r,u,d)=>{r?a(r):h(u)})});return t.timeout?o(s,t.timeout):s}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(e,t){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=e,this.http=new P(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator=`
`,this.encoding="utf-8",this.startTime=new Date().getTime(),Object.assign(this,t),this.log("",`\u{1F514}${this.name}, \u5F00\u59CB!`)}getEnv(){if(typeof $environment<"u"&&$environment["surge-version"])return"Surge";if(typeof $environment<"u"&&$environment["stash-version"])return"Stash";if(typeof m<"u"&&m.exports)return"Node.js";if(typeof $task<"u")return"Quantumult X";if(typeof $loon<"u")return"Loon";if(typeof $rocket<"u")return"Shadowrocket"}isNode(){return this.getEnv()==="Node.js"}isQuanX(){return this.getEnv()==="Quantumult X"}isSurge(){return this.getEnv()==="Surge"}isLoon(){return this.getEnv()==="Loon"}isShadowrocket(){return this.getEnv()==="Shadowrocket"}isStash(){return this.getEnv()==="Stash"}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null,...n){try{return JSON.stringify(e,...n)}catch{return t}}getjson(e,t){let n=t;if(this.getdata(e))try{n=JSON.parse(this.getdata(e))}catch{}return n}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise(t=>{this.get({url:e},(n,i,o)=>t(o))})}runScript(e,t){return new Promise(n=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i&&i.replace(/\n/g,"").trim();let o=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");o=o?o*1:20,o=t&&t.timeout?t.timeout:o;let[s,h]=i.split("@"),a={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:o},headers:{"X-Key":s,Accept:"*/*"},policy:"DIRECT",timeout:o};this.post(a,(r,u,d)=>n(d))}).catch(n=>this.logErr(n))}loaddata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");let e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(e),i=!n&&this.fs.existsSync(t);if(n||i){let o=n?e:t;try{return JSON.parse(this.fs.readFileSync(o))}catch{return{}}}else return{}}else return{}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");let e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(e),i=!n&&this.fs.existsSync(t),o=JSON.stringify(this.data);n?this.fs.writeFileSync(e,o):i?this.fs.writeFileSync(t,o):this.fs.writeFileSync(e,o)}}lodash_get(e,t,n=void 0){let i=t.replace(/\[(\d+)\]/g,".$1").split("."),o=e;for(let s of i)if(o=Object(o)[s],o===void 0)return n;return o}lodash_set(e,t,n){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce((i,o,s)=>Object(i[o])===i[o]?i[o]:i[o]=Math.abs(t[s+1])>>0===+t[s+1]?[]:{},e)[t[t.length-1]]=n),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){let[,n,i]=/^@(.*?)\.(.*?)$/.exec(e),o=n?this.getval(n):"";if(o)try{let s=JSON.parse(o);t=s?this.lodash_get(s,i,""):t}catch{t=""}}return t}setdata(e,t){let n=!1;if(/^@/.test(t)){let[,i,o]=/^@(.*?)\.(.*?)$/.exec(t),s=this.getval(i),h=i?s==="null"?null:s||"{}":"{}";try{let a=JSON.parse(h);this.lodash_set(a,o,e),n=this.setval(JSON.stringify(a),i)}catch{let r={};this.lodash_set(r,o,e),n=this.setval(JSON.stringify(r),i)}}else n=this.setval(e,t);return n}getval(e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);case"Node.js":return this.data=this.loaddata(),this.data[e];default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);case"Node.js":return this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0;default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},e&&(e.headers=e.headers?e.headers:{},e.headers.cookie===void 0&&e.headers.Cookie===void 0&&e.cookieJar===void 0&&(e.cookieJar=this.ckjar)))}get(e,t=()=>{}){switch(e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"],delete e.headers["content-type"],delete e.headers["content-length"]),e.params&&(e.url+="?"+this.queryStr(e.params)),typeof e.followRedirect<"u"&&!e.followRedirect&&((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,(i,o,s)=>{!i&&o&&(o.body=s,o.statusCode=o.status?o.status:o.statusCode,o.status=o.statusCode),t(i,o,s)});break;case"Quantumult X":this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(i=>{let{statusCode:o,statusCode:s,headers:h,body:a,bodyBytes:r}=i;t(null,{status:o,statusCode:s,headers:h,body:a,bodyBytes:r},a,r)},i=>t(i&&i.error||"UndefinedError"));break;case"Node.js":let n=require("iconv-lite");this.initGotEnv(e),this.got(e).on("redirect",(i,o)=>{try{if(i.headers["set-cookie"]){let s=i.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),o.cookieJar=this.ckjar}}catch(s){this.logErr(s)}}).then(i=>{let{statusCode:o,statusCode:s,headers:h,rawBody:a}=i,r=n.decode(a,this.encoding);t(null,{status:o,statusCode:s,headers:h,rawBody:a,body:r},r)},i=>{let{message:o,response:s}=i;t(o,s,s&&n.decode(s.rawBody,this.encoding))});break}}post(e,t=()=>{}){let n=e.method?e.method.toLocaleLowerCase():"post";switch(e.body&&e.headers&&!e.headers["Content-Type"]&&!e.headers["content-type"]&&(e.headers["content-type"]="application/x-www-form-urlencoded"),e.headers&&(delete e.headers["Content-Length"],delete e.headers["content-length"]),typeof e.followRedirect<"u"&&!e.followRedirect&&((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[n](e,(h,a,r)=>{!h&&a&&(a.body=r,a.statusCode=a.status?a.status:a.statusCode,a.status=a.statusCode),t(h,a,r)});break;case"Quantumult X":e.method=n,this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(h=>{let{statusCode:a,statusCode:r,headers:u,body:d,bodyBytes:l}=h;t(null,{status:a,statusCode:r,headers:u,body:d,bodyBytes:l},d,l)},h=>t(h&&h.error||"UndefinedError"));break;case"Node.js":let i=require("iconv-lite");this.initGotEnv(e);let{url:o,...s}=e;this.got[n](o,s).then(h=>{let{statusCode:a,statusCode:r,headers:u,rawBody:d}=h,l=i.decode(d,this.encoding);t(null,{status:a,statusCode:r,headers:u,rawBody:d,body:l},l)},h=>{let{message:a,response:r}=h;t(a,r,r&&i.decode(r.rawBody,this.encoding))});break}}time(e,t=null){let n=t?new Date(t):new Date,i={"M+":n.getMonth()+1,"d+":n.getDate(),"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(let o in i)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?i[o]:("00"+i[o]).substr((""+i[o]).length)));return e}queryStr(e){let t="";for(let n in e){let i=e[n];i!=null&&i!==""&&(typeof i=="object"&&(i=JSON.stringify(i)),t+=`${n}=${i}&`)}return t=t.substring(0,t.length-1),t}msg(e=p,t="",n="",i={}){let o=s=>{let{$open:h,$copy:a,$media:r,$mediaMime:u}=s;switch(typeof s){case void 0:return s;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:s};case"Loon":case"Shadowrocket":return s;case"Quantumult X":return{"open-url":s};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let d={},l=s.openUrl||s.url||s["open-url"]||h;l&&Object.assign(d,{action:"open-url",url:l});let g=s["update-pasteboard"]||s.updatePasteboard||a;g&&Object.assign(d,{action:"clipboard",text:g});let c=s.mediaUrl||s["media-url"]||r;if(c){let v,y;if(!c.startsWith("http"))if(c.startsWith("data:")){let[b]=c.split(";"),[,j]=c.split(",");v=j,y=b.replace("data:","")}else{let b=j=>{let E={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var L in E)if(j.indexOf(L)===0)return E[L];return null};v=c,y=b(c)}Object.assign(d,{"media-url":c,"media-base64":v,"media-base64-mime":u??y})}return Object.assign(d,{"auto-dismiss":s["auto-dismiss"],sound:s.sound}),d}case"Loon":{let d={},l=s.openUrl||s.url||s["open-url"]||h;l&&Object.assign(d,{openUrl:l});let g=s.mediaUrl||s["media-url"]||r;return g&&Object.assign(d,{mediaUrl:g}),console.log(JSON.stringify(d)),d}case"Quantumult X":{let d={},l=s["open-url"]||s.url||s.openUrl||h;l&&Object.assign(d,{"open-url":l});let g=s.mediaUrl||s["media-url"]||r;g&&Object.assign(d,{"media-url":g});let c=s["update-pasteboard"]||s.updatePasteboard||a;return c&&Object.assign(d,{"update-pasteboard":c}),console.log(JSON.stringify(d)),d}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,t,n,o(i));break;case"Quantumult X":$notify(e,t,n,o(i));break;case"Node.js":break}if(!this.isMuteLog){let s=["","==============\u{1F4E3}\u7CFB\u7EDF\u901A\u77E5\u{1F4E3}=============="];s.push(e),t&&s.push(t),n&&s.push(n),console.log(s.join(`
`)),this.logs=this.logs.concat(s)}}debug(...e){this.logLevels[this.logLevel]<=this.logLevels.debug&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.debug}${e.map(t=>t??String(t)).join(this.logSeparator)}`))}info(...e){this.logLevels[this.logLevel]<=this.logLevels.info&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.info}${e.map(t=>t??String(t)).join(this.logSeparator)}`))}warn(...e){this.logLevels[this.logLevel]<=this.logLevels.warn&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.warn}${e.map(t=>t??String(t)).join(this.logSeparator)}`))}error(...e){this.logLevels[this.logLevel]<=this.logLevels.error&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.error}${e.map(t=>t??String(t)).join(this.logSeparator)}`))}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.map(t=>t??String(t)).join(this.logSeparator))}logErr(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,t,e);break;case"Node.js":this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,t,typeof e.message<"u"?e.message:e,e.stack);break}}wait(e){return new Promise(t=>setTimeout(t,e))}done(e={}){let n=(new Date().getTime()-this.startTime)/1e3;switch(this.log("",`\u{1F514}${this.name}, \u7ED3\u675F! \u{1F55B} ${n} \u79D2`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(e);break;case"Node.js":process.exit(1)}}}(p,f)}m.exports=_});var D="cict_signin_record",M=C(),O=new M("cict signin"),R=$request.body,$=JSON.parse(R),x=$?.root?.object?.isOffice||!1,k=new Date,w=k.getHours()>=12?"PM":"AM",N=k.toLocaleDateString(),J=k.toLocaleTimeString(),S=O.getjson(D,{});S.date!==N&&(S={date:N,records:[],AM_SIGNIN:!1,PM_SIGNIN:!1});S.records.push({date:N,time:J,period:w,isOffice:x,signCount:$?.root?.object?.signCount??-1,id:$?.root?.object?.id??""});x&&(w==="AM"?S.AM_SIGNIN=!0:w==="PM"&&(S.PM_SIGNIN=!0));O.setjson(S,D);O.done(R);
