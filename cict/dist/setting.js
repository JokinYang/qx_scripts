/*     * This is a generated file. Do not edit it manually.
        Generated by esbuild.
*/
(()=>{var v=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(h,f)=>(typeof require<"u"?require:h)[f]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var N=(o,h)=>()=>(h||o((h={exports:{}}).exports,h),h.exports);var O=N((J,y)=>{function E(o,h){class f{constructor(e){this.env=e}send(e,a="GET"){e=typeof e=="string"?{url:e}:e;let i=this.get;a==="POST"&&(i=this.post);let n=(l,c=1e3)=>Promise.race([l,new Promise((d,b)=>{setTimeout(()=>{b(new Error("\u8BF7\u6C42\u8D85\u65F6"))},c)})]),s=new Promise((l,c)=>{i.call(this,e,(d,b,u)=>{d?c(d):l(b)})});return e.timeout?n(s,e.timeout):s}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(t,e){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=t,this.http=new f(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator=`
`,this.encoding="utf-8",this.startTime=new Date().getTime(),Object.assign(this,e),this.log("",`\u{1F514}${this.name}, \u5F00\u59CB!`)}getEnv(){if(typeof $environment<"u"&&$environment["surge-version"])return"Surge";if(typeof $environment<"u"&&$environment["stash-version"])return"Stash";if(typeof y<"u"&&y.exports)return"Node.js";if(typeof $task<"u")return"Quantumult X";if(typeof $loon<"u")return"Loon";if(typeof $rocket<"u")return"Shadowrocket"}isNode(){return this.getEnv()==="Node.js"}isQuanX(){return this.getEnv()==="Quantumult X"}isSurge(){return this.getEnv()==="Surge"}isLoon(){return this.getEnv()==="Loon"}isShadowrocket(){return this.getEnv()==="Shadowrocket"}isStash(){return this.getEnv()==="Stash"}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null,...a){try{return JSON.stringify(t,...a)}catch{return e}}getjson(t,e){let a=e;if(this.getdata(t))try{a=JSON.parse(this.getdata(t))}catch{}return a}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(a,i,n)=>e(n))})}runScript(t,e){return new Promise(a=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i&&i.replace(/\n/g,"").trim();let n=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");n=n?n*1:20,n=e&&e.timeout?e.timeout:n;let[s,l]=i.split("@"),c={url:`http://${l}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:n},headers:{"X-Key":s,Accept:"*/*"},policy:"DIRECT",timeout:n};this.post(c,(d,b,u)=>a(u))}).catch(a=>this.logErr(a))}loaddata(){if(this.isNode()){this.fs=this.fs?this.fs:v("fs"),this.path=this.path?this.path:v("path");let t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),a=this.fs.existsSync(t),i=!a&&this.fs.existsSync(e);if(a||i){let n=a?t:e;try{return JSON.parse(this.fs.readFileSync(n))}catch{return{}}}else return{}}else return{}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:v("fs"),this.path=this.path?this.path:v("path");let t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),a=this.fs.existsSync(t),i=!a&&this.fs.existsSync(e),n=JSON.stringify(this.data);a?this.fs.writeFileSync(t,n):i?this.fs.writeFileSync(e,n):this.fs.writeFileSync(t,n)}}lodash_get(t,e,a=void 0){let i=e.replace(/\[(\d+)\]/g,".$1").split("."),n=t;for(let s of i)if(n=Object(n)[s],n===void 0)return a;return n}lodash_set(t,e,a){return Object(t)!==t||(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((i,n,s)=>Object(i[n])===i[n]?i[n]:i[n]=Math.abs(e[s+1])>>0===+e[s+1]?[]:{},t)[e[e.length-1]]=a),t}getdata(t){let e=this.getval(t);if(/^@/.test(t)){let[,a,i]=/^@(.*?)\.(.*?)$/.exec(t),n=a?this.getval(a):"";if(n)try{let s=JSON.parse(n);e=s?this.lodash_get(s,i,""):e}catch{e=""}}return e}setdata(t,e){let a=!1;if(/^@/.test(e)){let[,i,n]=/^@(.*?)\.(.*?)$/.exec(e),s=this.getval(i),l=i?s==="null"?null:s||"{}":"{}";try{let c=JSON.parse(l);this.lodash_set(c,n,t),a=this.setval(JSON.stringify(c),i)}catch{let d={};this.lodash_set(d,n,t),a=this.setval(JSON.stringify(d),i)}}else a=this.setval(t,e);return a}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:v("got"),this.cktough=this.cktough?this.cktough:v("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},t&&(t.headers=t.headers?t.headers:{},t.headers.cookie===void 0&&t.headers.Cookie===void 0&&t.cookieJar===void 0&&(t.cookieJar=this.ckjar)))}get(t,e=()=>{}){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),typeof t.followRedirect<"u"&&!t.followRedirect&&((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(i,n,s)=>{!i&&n&&(n.body=s,n.statusCode=n.status?n.status:n.statusCode,n.status=n.statusCode),e(i,n,s)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(i=>{let{statusCode:n,statusCode:s,headers:l,body:c,bodyBytes:d}=i;e(null,{status:n,statusCode:s,headers:l,body:c,bodyBytes:d},c,d)},i=>e(i&&i.error||"UndefinedError"));break;case"Node.js":let a=v("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(i,n)=>{try{if(i.headers["set-cookie"]){let s=i.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),n.cookieJar=this.ckjar}}catch(s){this.logErr(s)}}).then(i=>{let{statusCode:n,statusCode:s,headers:l,rawBody:c}=i,d=a.decode(c,this.encoding);e(null,{status:n,statusCode:s,headers:l,rawBody:c,body:d},d)},i=>{let{message:n,response:s}=i;e(n,s,s&&a.decode(s.rawBody,this.encoding))});break}}post(t,e=()=>{}){let a=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),typeof t.followRedirect<"u"&&!t.followRedirect&&((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[a](t,(l,c,d)=>{!l&&c&&(c.body=d,c.statusCode=c.status?c.status:c.statusCode,c.status=c.statusCode),e(l,c,d)});break;case"Quantumult X":t.method=a,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(l=>{let{statusCode:c,statusCode:d,headers:b,body:u,bodyBytes:g}=l;e(null,{status:c,statusCode:d,headers:b,body:u,bodyBytes:g},u,g)},l=>e(l&&l.error||"UndefinedError"));break;case"Node.js":let i=v("iconv-lite");this.initGotEnv(t);let{url:n,...s}=t;this.got[a](n,s).then(l=>{let{statusCode:c,statusCode:d,headers:b,rawBody:u}=l,g=i.decode(u,this.encoding);e(null,{status:c,statusCode:d,headers:b,rawBody:u,body:g},g)},l=>{let{message:c,response:d}=l;e(c,d,d&&i.decode(d.rawBody,this.encoding))});break}}time(t,e=null){let a=e?new Date(e):new Date,i={"M+":a.getMonth()+1,"d+":a.getDate(),"H+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(let n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t}queryStr(t){let e="";for(let a in t){let i=t[a];i!=null&&i!==""&&(typeof i=="object"&&(i=JSON.stringify(i)),e+=`${a}=${i}&`)}return e=e.substring(0,e.length-1),e}msg(t=o,e="",a="",i={}){let n=s=>{let{$open:l,$copy:c,$media:d,$mediaMime:b}=s;switch(typeof s){case void 0:return s;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:s};case"Loon":case"Shadowrocket":return s;case"Quantumult X":return{"open-url":s};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let u={},g=s.openUrl||s.url||s["open-url"]||l;g&&Object.assign(u,{action:"open-url",url:g});let m=s["update-pasteboard"]||s.updatePasteboard||c;m&&Object.assign(u,{action:"clipboard",text:m});let p=s.mediaUrl||s["media-url"]||d;if(p){let x,S;if(!p.startsWith("http"))if(p.startsWith("data:")){let[w]=p.split(";"),[,k]=p.split(",");x=k,S=w.replace("data:","")}else{let w=k=>{let $={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var j in $)if(k.indexOf(j)===0)return $[j];return null};x=p,S=w(p)}Object.assign(u,{"media-url":p,"media-base64":x,"media-base64-mime":b??S})}return Object.assign(u,{"auto-dismiss":s["auto-dismiss"],sound:s.sound}),u}case"Loon":{let u={},g=s.openUrl||s.url||s["open-url"]||l;g&&Object.assign(u,{openUrl:g});let m=s.mediaUrl||s["media-url"]||d;return m&&Object.assign(u,{mediaUrl:m}),console.log(JSON.stringify(u)),u}case"Quantumult X":{let u={},g=s["open-url"]||s.url||s.openUrl||l;g&&Object.assign(u,{"open-url":g});let m=s.mediaUrl||s["media-url"]||d;m&&Object.assign(u,{"media-url":m});let p=s["update-pasteboard"]||s.updatePasteboard||c;return p&&Object.assign(u,{"update-pasteboard":p}),console.log(JSON.stringify(u)),u}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(t,e,a,n(i));break;case"Quantumult X":$notify(t,e,a,n(i));break;case"Node.js":break}if(!this.isMuteLog){let s=["","==============\u{1F4E3}\u7CFB\u7EDF\u901A\u77E5\u{1F4E3}=============="];s.push(t),e&&s.push(e),a&&s.push(a),console.log(s.join(`
`)),this.logs=this.logs.concat(s)}}debug(...t){this.logLevels[this.logLevel]<=this.logLevels.debug&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.debug}${t.map(e=>e??String(e)).join(this.logSeparator)}`))}info(...t){this.logLevels[this.logLevel]<=this.logLevels.info&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.info}${t.map(e=>e??String(e)).join(this.logSeparator)}`))}warn(...t){this.logLevels[this.logLevel]<=this.logLevels.warn&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.warn}${t.map(e=>e??String(e)).join(this.logSeparator)}`))}error(...t){this.logLevels[this.logLevel]<=this.logLevels.error&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.error}${t.map(e=>e??String(e)).join(this.logSeparator)}`))}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.map(e=>e??String(e)).join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,e,t);break;case"Node.js":this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,e,typeof t.message<"u"?t.message:t,t.stack);break}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){let a=(new Date().getTime()-this.startTime)/1e3;switch(this.log("",`\u{1F514}${this.name}, \u7ED3\u675F! \u{1F55B} ${a} \u79D2`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(o,h)}y.exports=E});var L=O(),r=new L("CICT Setting"),T="cict_signin_record",C="cict_setting";r.version="1.0.0";r.versionType="release";r.isNeedRewrite=!0;r.json=r.name;r.html=r.name;(async()=>{r.path=D($request.url);let[,o]=r.path.split("?");r.queries=o?o.split("&").reduce((h,f)=>{let[t,e]=f.split("=");return h[t]=decodeURIComponent(e||""),h},{}):{},r.isGet=$request.method==="GET",r.isPost=$request.method==="POST",r.isOptions=$request.method==="OPTIONS",r.isOptions?await _():r.isGet?await I():r.isPost&&await P()})().catch(o=>r.logErr(o)).finally(()=>z());function D(o){let h=o.lastIndexOf("/")===o.length-1?-1:void 0;return o.slice(o.indexOf("/",8),h)}async function I(){let o=M(),h=F();r.html=G(o,h)}async function P(){switch(r.queries.action||"unknown"){case"save":await R();break;default:r.json={success:!1,message:"Unknown action"}}}async function _(){}function M(){return r.getjson(T,{})}function F(){return Object.assign({autoSignin:!0,notification:!0,retentionDays:30},r.getjson(C,{}))}async function R(){try{let o=r.toObj($request.body);o.type==="settings"?(r.setjson(o.settings,C),r.json={success:!0,message:"\u8BBE\u7F6E\u4FDD\u5B58\u6210\u529F"}):r.json={success:!1,message:"\u65E0\u6548\u7684\u4FDD\u5B58\u7C7B\u578B"}}catch(o){r.json={success:!1,message:"\u4FDD\u5B58\u5931\u8D25: "+o.message}}}function G(o,h){let f=new Date().toLocaleDateString(),t=o.date===f?o:{date:f,records:[],AM_SIGNIN:!1,PM_SIGNIN:!1};return`
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CICT \u7B7E\u5230\u7BA1\u7406</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.4;
        }
        
        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 16px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 13px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 14px 8px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 15px;
            color: #6c757d;
            transition: all 0.3s;
            outline: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .tab.active {
            color: #667eea;
            background: white;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            padding: 16px;
            min-height: 350px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* \u4ECA\u65E5\u72B6\u6001\u6837\u5F0F */
        .today-status {
            margin-bottom: 20px;
        }
        
        .today-status h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .status-card {
            padding: 14px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            position: relative;
        }
        
        .status-card.success {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .status-card.pending {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .status-icon {
            font-size: 18px;
            margin-bottom: 6px;
            display: block;
        }
        
        .status-text {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 13px;
        }
        
        .status-label {
            font-size: 11px;
            color: #6c757d;
        }
        
        /* \u7EDF\u8BA1\u4FE1\u606F\u6837\u5F0F */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 18px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            display: block;
        }
        
        .stat-label {
            font-size: 11px;
            color: #6c757d;
            margin-top: 3px;
        }
        
        /* \u8BB0\u5F55\u5217\u8868\u6837\u5F0F */
        .records-section h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .record-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }
        
        .record-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .record-time {
            font-weight: 600;
            color: #333;
            font-size: 13px;
        }
        
        .badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .badge-morning {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-afternoon {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .record-details {
            display: grid;
            gap: 3px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        
        .label {
            color: #6c757d;
        }
        
        .value {
            font-weight: 500;
        }
        
        .value.success {
            color: #28a745;
        }
        
        .value.error {
            color: #dc3545;
        }
        
        .no-records {
            text-align: center;
            color: #6c757d;
            padding: 30px 15px;
            font-style: italic;
            font-size: 14px;
        }
        
        /* \u914D\u7F6E\u9875\u9762\u6837\u5F0F */
        .config-content h3 {
            color: #333;
            margin-bottom: 16px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .config-item:last-child {
            border-bottom: none;
        }
        
        .config-item label {
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 22px;
            flex-shrink: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 22px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        .config-select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            min-width: 80px;
            font-size: 13px;
            outline: none;
        }
        
        .config-actions {
            margin-top: 20px;
            text-align: center;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            outline: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:active {
            background: #5a6fd8;
            transform: scale(0.98);
        }
        
        /* \u79FB\u52A8\u7AEF\u4F18\u5316 */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 14px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .tab-content {
                padding: 14px;
            }
            
            .status-card {
                padding: 12px;
            }
            
            .stat-card {
                padding: 10px;
            }
            
            .record-item {
                padding: 10px;
            }
        }
        
        /* \u6697\u8272\u6A21\u5F0F\u652F\u6301 */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            }
            
            .container {
                background: #1a1a1a;
                color: #ffffff;
            }
            
            .tabs {
                background: #2c2c2c;
                border-color: #404040;
            }
            
            .tab {
                color: #999;
            }
            
            .tab.active {
                color: #667eea;
                background: #1a1a1a;
            }
            
            .today-status h3,
            .records-section h3,
            .config-content h3 {
                color: #ffffff;
            }
            
            .record-item {
                background: #2c2c2c;
                border-left-color: #667eea;
            }
            
            .stat-card {
                background: #2c2c2c;
                border-color: #404040;
            }
            
            .config-item {
                border-color: #404040;
            }
            
            .config-item label {
                color: #ffffff;
            }
            
            .no-records {
                color: #999;
            }
        }
        
        /* \u89E6\u6478\u53CD\u9988 */
        .tab:active {
            transform: scale(0.95);
        }
        
        .status-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>\u{1F4CB} CICT \u7B7E\u5230\u7BA1\u7406</h1>
            <p>\u67E5\u770B\u7B7E\u5230\u8BB0\u5F55\u548C\u7BA1\u7406\u914D\u7F6E</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'records')">\u{1F4CA} \u7B7E\u5230\u8BB0\u5F55</button>
            <button class="tab" onclick="switchTab(event, 'config')">\u2699\uFE0F \u8BBE\u7F6E</button>
        </div>
        
        <div class="tab-content">
            <div id="records" class="tab-pane active">
                ${B(t)}
            </div>
            <div id="config" class="tab-pane">
                ${X(h)}
            </div>
        </div>
    </div>
    
    <script>
        // \u521D\u59CB\u5316\u8BBE\u7F6E\u6570\u636E
        const settingsData = ${JSON.stringify(h)};
        
        function switchTab(evt, tabName) {
            var i, tabcontent, tablinks;
            
            tabcontent = document.getElementsByClassName("tab-pane");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        function saveConfig() {
            const autoSignin = document.getElementById('autoSignin').checked;
            const notification = document.getElementById('notification').checked;
            const retentionDays = document.getElementById('retentionDays').value;
            
            const settings = {
                autoSignin,
                notification,
                retentionDays: parseInt(retentionDays)
            };
            
            // \u663E\u793A\u4FDD\u5B58\u63D0\u793A
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.textContent;
            btn.textContent = '\u4FDD\u5B58\u4E2D...';
            btn.disabled = true;
            
            fetch(window.location.href + '?action=save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: 'settings',
                    settings: settings
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    btn.textContent = '\u4FDD\u5B58\u6210\u529F \u2713';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 1500);
                } else {
                    btn.textContent = '\u4FDD\u5B58\u5931\u8D25';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 1500);
                }
            })
            .catch(error => {
                btn.textContent = '\u4FDD\u5B58\u5931\u8D25';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 1500);
            });
        }
        
        // \u521D\u59CB\u5316\u8BBE\u7F6E\u503C
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('autoSignin').checked = settingsData.autoSignin;
            document.getElementById('notification').checked = settingsData.notification;
            document.getElementById('retentionDays').value = settingsData.retentionDays;
        });
        
        // \u9632\u6B62\u9875\u9762\u6EDA\u52A8\u65F6\u7684\u6A61\u76AE\u7B4B\u6548\u679C
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('.tab-content')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
        
        // \u89E6\u6478\u53CD\u9988
        document.addEventListener('touchstart', function(e) {
            if (e.target.classList.contains('tab') || e.target.classList.contains('btn')) {
                e.target.style.opacity = '0.7';
            }
        });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.classList.contains('tab') || e.target.classList.contains('btn')) {
                setTimeout(() => {
                    e.target.style.opacity = '';
                }, 100);
            }
        });
    <\/script>
</body>
</html>
  `}function B(o){let h=o.records.map(e=>{let a=e.isOffice?"\u2705":"\u274C",i=e.period==="AM"?'<span class="badge badge-morning">\u4E0A\u5348</span>':'<span class="badge badge-afternoon">\u4E0B\u5348</span>';return`
      <div class="record-item">
        <div class="record-header">
          <span class="record-time">${e.time}</span>
          ${i}
          <span class="status-icon">${a}</span>
        </div>
        <div class="record-details">
          <div class="detail-item">
            <span class="label">\u7B7E\u5230\u72B6\u6001:</span>
            <span class="value ${e.isOffice?"success":"error"}">${e.isOffice?"\u6210\u529F":"\u5931\u8D25"}</span>
          </div>
          <div class="detail-item">
            <span class="label">\u7B7E\u5230\u6B21\u6570:</span>
            <span class="value">${e.signCount}</span>
          </div>
          ${e.id?`<div class="detail-item">
            <span class="label">\u8BB0\u5F55ID:</span>
            <span class="value">${e.id.slice(-8)}</span>
          </div>`:""}
        </div>
      </div>
    `}).join(""),f=o.records.length,t=o.records.filter(e=>e.isOffice).length;return`
    <div class="today-status">
      <h3>\u4ECA\u65E5\u7B7E\u5230\u72B6\u6001 (${o.date||new Date().toLocaleDateString()})</h3>
      <div class="status-grid">
        <div class="status-card ${o.AM_SIGNIN?"success":"pending"}">
          <div class="status-icon">${o.AM_SIGNIN?"\u2705":"\u23F0"}</div>
          <div class="status-text">\u4E0A\u5348\u7B7E\u5230</div>
          <div class="status-label">${o.AM_SIGNIN?"\u5DF2\u5B8C\u6210":"\u672A\u5B8C\u6210"}</div>
        </div>
        <div class="status-card ${o.PM_SIGNIN?"success":"pending"}">
          <div class="status-icon">${o.PM_SIGNIN?"\u2705":"\u23F0"}</div>
          <div class="status-text">\u4E0B\u5348\u7B7E\u5230</div>
          <div class="status-label">${o.PM_SIGNIN?"\u5DF2\u5B8C\u6210":"\u672A\u5B8C\u6210"}</div>
        </div>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">${f}</div>
        <div class="stat-label">\u4ECA\u65E5\u7B7E\u5230\u6B21\u6570</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${t}</div>
        <div class="stat-label">\u6210\u529F\u6B21\u6570</div>
      </div>
    </div>
    
    <div class="records-section">
      <h3>\u8BE6\u7EC6\u8BB0\u5F55</h3>
      <div class="records-list">
        ${h||'<div class="no-records">\u6682\u65E0\u7B7E\u5230\u8BB0\u5F55</div>'}
      </div>
    </div>
  `}function X(o){return`
    <div class="config-content">
      <h3>\u7B7E\u5230\u8BBE\u7F6E</h3>
      <div class="config-section">
        <div class="config-item">
          <label>\u81EA\u52A8\u7B7E\u5230</label>
          <div class="toggle-switch">
            <input type="checkbox" id="autoSignin" ${o.autoSignin?"checked":""}>
            <label for="autoSignin" class="slider"></label>
          </div>
        </div>
        <div class="config-item">
          <label>\u901A\u77E5\u63A8\u9001</label>
          <div class="toggle-switch">
            <input type="checkbox" id="notification" ${o.notification?"checked":""}>
            <label for="notification" class="slider"></label>
          </div>
        </div>
        <div class="config-item">
          <label>\u8BB0\u5F55\u4FDD\u7559\u5929\u6570</label>
          <select id="retentionDays" class="config-select">
            <option value="7" ${o.retentionDays===7?"selected":""}>7\u5929</option>
            <option value="30" ${o.retentionDays===30?"selected":""}>30\u5929</option>
            <option value="90" ${o.retentionDays===90?"selected":""}>90\u5929</option>
          </select>
        </div>
      </div>
      
      <div class="config-actions">
        <button class="btn btn-primary" onclick="saveConfig()">\u4FDD\u5B58\u8BBE\u7F6E</button>
      </div>
    </div>
  `}function z(){let o={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST,GET,OPTIONS,PUT,DELETE","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"};if(r.isOptions)r.isQuanX()?r.done({headers:o}):r.done({response:{headers:o}});else if(r.isGet){let h=Object.assign(o,{"Content-Type":"text/html;charset=UTF-8"});r.isQuanX()?r.done({status:"HTTP/1.1 200",headers:h,body:r.html}):r.done({response:{status:200,headers:h,body:r.html}})}else if(r.isPost){let h=Object.assign(o,{"Content-Type":"application/json; charset=utf-8"}),f=r.toStr(r.json);r.isQuanX()?r.done({status:"HTTP/1.1 200",headers:h,body:f}):r.done({response:{status:200,headers:h,body:f}})}else r.done()}})();
